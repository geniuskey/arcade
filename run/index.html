<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nebula Run - Arcade</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@800&family=Space+Grotesk:wght@700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-pink: #ff00ff;
            --bg-dark: #020010;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-dark);
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            touch-action: none;
        }

        #top-bar {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 15;
            position: fixed;
            top: 0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--neon-blue);
        }

        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 700;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #screens {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.3);
        }

        .screen {
            background: rgba(2, 0, 16, 0.95);
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            display: none;
            flex-direction: column;
            gap: 20px;
            max-width: 90%;
            pointer-events: auto;
        }

        .screen.active {
            display: flex;
        }

        h2 {
            font-size: 36px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .diff-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .diff-btn.active {
            background: var(--neon-purple);
            border-color: var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple);
        }

        .btn {
            padding: 15px 40px;
            background: var(--neon-blue);
            color: var(--bg-dark);
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #hint {
            position: fixed;
            bottom: 40px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.3);
            font-size: 14px;
            pointer-events: none;
        }

        .back-btn {
            position: fixed;
            top: 50px;
            left: 20px;
            z-index: 1000;
            text-decoration: none;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 12px;
            border-radius: 15px;
            font-family: sans-serif;
            font-size: 12px;
            transition: background 0.3s;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .back-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>

<body>
    <a href="../" class="back-btn">‚Üê Arcade</a>
    <div id="top-bar">
        <div class="stat-item">
            <span class="stat-label">Distance</span>
            <span id="score" class="stat-value">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Difficulty</span>
            <span id="current-diff-display" class="stat-value"
                style="font-size: 12px; color: var(--neon-purple);">NORMAL</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Best</span>
            <span id="best-score" class="stat-value">0</span>
        </div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div id="screens">
            <div id="start-screen" class="screen active">
                <h2>NEBULA RUN</h2>
                <div class="difficulty-selector">
                    <button class="diff-btn" onclick="setDifficulty('easy')">EASY</button>
                    <button class="diff-btn active" onclick="setDifficulty('normal')">NORMAL</button>
                    <button class="diff-btn" onclick="setDifficulty('hard')">HARD</button>
                </div>
                <p style="opacity: 0.7;">Tap or press any key to engage thrusters.</p>
                <button class="btn" onclick="startGame()">IGNITE</button>
            </div>

            <div id="game-over-screen" class="screen">
                <h2>SIGNAL LOST</h2>
                <p>The nebula has claimed your vessel.</p>
                <div style="margin: 10px 0;">
                    <div class="stat-label">Final Distance</div>
                    <div id="final-score" class="stat-value">0</div>
                </div>
                <button class="btn" onclick="startGame()">RELAUNCH</button>
            </div>
        </div>
    </div>

    <div id="hint">Tap to fly up</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const bestScoreEl = document.getElementById('best-score');
        const finalScoreEl = document.getElementById('final-score');

        // Game Constants
        const ROCKET_WIDTH = 40;
        const ROCKET_HEIGHT = 30;
        const PIPE_WIDTH = 60;
        const PIPE_GAP = 180;

        const DIFFICULTIES = {
            easy: { gravity: 0.35, thrust: -7.5, speed: 3, gap: 220, label: 'EASY' },
            normal: { gravity: 0.50, thrust: -9.5, speed: 4.5, gap: 180, label: 'NORMAL' },
            hard: { gravity: 0.65, thrust: -11.5, speed: 6.5, gap: 150, label: 'HARD' }
        };

        // Game State
        let currentDifficulty = 'normal';
        let gameActive = false;
        let lastTime = performance.now();

        let rocket = {
            x: 100,
            y: 0,
            vy: 0
        };

        let pipes = [];
        let particles = [];
        let score = 0;

        function setDifficulty(diff) {
            currentDifficulty = diff;
            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.classList.toggle('active', btn.innerText.toLowerCase() === diff);
            });
            document.getElementById('current-diff-display').innerText = DIFFICULTIES[diff].label;
            updateBestScoreDisplay();
        }

        function updateBestScoreDisplay() {
            const best = localStorage.getItem(`run_best_${currentDifficulty}`) || 0;
            bestScoreEl.innerText = best;
        }

        function initGame() {
            rocket.y = canvas.height / 2;
            rocket.vy = 0;
            pipes = [];
            particles = [];
            score = 0;
            scoreEl.innerText = '0';
            updateBestScoreDisplay();
            spawnPipe(canvas.width + 200);
            spawnPipe(canvas.width + 600);
            lastTime = performance.now();
        }

        function spawnPipe(x) {
            const config = DIFFICULTIES[currentDifficulty];
            const minH = 50;
            const maxH = canvas.height - config.gap - minH;
            const topH = Math.random() * (maxH - minH) + minH;
            pipes.push({
                x,
                top: topH,
                passed: false
            });
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (!gameActive) initGame();
        }

        window.addEventListener('resize', resize);
        resize();

        function startGame() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            initGame();
            gameActive = true;
        }

        function gameOver() {
            gameActive = false;
            finalScoreEl.innerText = score;
            const bestKey = `run_best_${currentDifficulty}`;
            const best = parseInt(localStorage.getItem(bestKey) || 0);
            if (score > best) {
                localStorage.setItem(bestKey, score);
                bestScoreEl.innerText = score;
            }
            document.getElementById('game-over-screen').classList.add('active');
        }

        function jump() {
            if (!gameActive) return;
            rocket.vy = DIFFICULTIES[currentDifficulty].thrust;

            // Add exhaust particles
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: rocket.x,
                    y: rocket.y + ROCKET_HEIGHT / 2,
                    vx: -Math.random() * 5 - 2,
                    vy: (Math.random() - 0.5) * 4,
                    life: 1.0,
                    size: Math.random() * 5 + 2
                });
            }
        }

        function update(timestamp) {
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            const f = Math.min(deltaTime / (1000 / 60), 3);

            if (gameActive) {
                const config = DIFFICULTIES[currentDifficulty];

                // Rocket Physics
                rocket.vy += config.gravity * f;
                rocket.y += rocket.vy * f;

                if (rocket.y < 0 || rocket.y + ROCKET_HEIGHT > canvas.height) {
                    gameOver();
                }

                // Pipes
                pipes.forEach((p, idx) => {
                    p.x -= config.speed * f;

                    // Collision
                    if (rocket.x + ROCKET_WIDTH > p.x && rocket.x < p.x + PIPE_WIDTH) {
                        if (rocket.y < p.top || rocket.y + ROCKET_HEIGHT > p.top + config.gap) {
                            gameOver();
                        }
                    }

                    // Score
                    if (!p.passed && rocket.x > p.x + PIPE_WIDTH) {
                        p.passed = true;
                        score++;
                        scoreEl.innerText = score;
                    }
                });

                pipes = pipes.filter(p => p.x + PIPE_WIDTH > -100);
                if (pipes.length > 0 && pipes[pipes.length - 1].x < canvas.width - 400) {
                    spawnPipe(canvas.width);
                }

                // Particles
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.02;
                });
                particles = particles.filter(p => p.life > 0);
            }

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Background Stars (Subtle)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.arc((i * 137) % canvas.width, (i * 251) % canvas.height, 1, 0, Math.PI * 2);
                ctx.fill();
            }

            const config = DIFFICULTIES[currentDifficulty];

            // Pipes (Nebula obstacles)
            pipes.forEach(p => {
                const gradient = ctx.createLinearGradient(p.x, 0, p.x + PIPE_WIDTH, 0);
                gradient.addColorStop(0, '#bc13fe');
                gradient.addColorStop(1, '#ff00ff');

                ctx.fillStyle = gradient;
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#bc13fe';

                // Top Pipe
                ctx.fillRect(p.x, 0, PIPE_WIDTH, p.top);
                // Bottom Pipe
                ctx.fillRect(p.x, p.top + config.gap, PIPE_WIDTH, canvas.height - (p.top + config.gap));

                ctx.shadowBlur = 0;
            });

            // Particles
            particles.forEach(p => {
                ctx.fillStyle = `rgba(0, 243, 255, ${p.life})`;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });

            // Rocket
            ctx.save();
            ctx.translate(rocket.x, rocket.y);
            // Tilt based on velocity
            ctx.rotate(Math.min(Math.max(rocket.vy * 0.05, -0.5), 0.5));

            // Vessel Body
            ctx.fillStyle = '#00f3ff';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#00f3ff';
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(ROCKET_WIDTH, ROCKET_HEIGHT / 2);
            ctx.lineTo(0, ROCKET_HEIGHT);
            ctx.closePath();
            ctx.fill();

            // Cockpit
            ctx.fillStyle = '#fff';
            ctx.fillRect(ROCKET_WIDTH * 0.4, ROCKET_HEIGHT * 0.35, ROCKET_WIDTH * 0.2, ROCKET_HEIGHT * 0.3);

            ctx.restore();
        }

        // Controls
        function handleInput(e) {
            if (!gameActive) {
                if (document.querySelector('.screen.active')) {
                    startGame();
                }
                return;
            }
            jump();
        }

        window.addEventListener('keydown', e => {
            if (['ArrowUp', ' '].includes(e.key)) e.preventDefault();
            handleInput();
        });
        window.addEventListener('pointerdown', handleInput);

        updateBestScoreDisplay();
        requestAnimationFrame(update);
    </script>
</body>

</html>